@use '@angular/material' as mat;

.engineer-form {
  @apply max-w-4xl mx-auto p-4 md:p-6;

  .mat-card {
    @apply p-6 shadow-lg rounded-xl bg-white dark:bg-gray-800 transition-all duration-200;
    
    &:hover {
      @apply shadow-xl;
    }

  /* Smooth fade-in for form container */
  .fade-in {
    animation: fadeInSoft 300ms ease-out;
  }

  @keyframes fadeInSoft {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Skeleton styles */
  .skeleton-card { position: relative; overflow: hidden; }
  .skeleton-row { display: flex; gap: 16px; margin-bottom: 16px; }
  .skeleton {
    position: relative;
    border-radius: 6px;
    background: #e5e7eb; /* gray-200 */
    overflow: hidden;
  }
  .skeleton::after {
    content: '';
    position: absolute;
    inset: 0;
    transform: translateX(-100%);
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
    animation: shimmer 1200ms infinite;
  }
  @keyframes shimmer {
    100% { transform: translateX(100%); }
  }
  .skeleton-title { height: 28px; width: 60%; }
  .skeleton-input { height: 56px; flex: 1; }
  .skeleton-btn { height: 40px; width: 140px; }
  .skeleton-btn-lg { height: 36px; width: 180px; margin-left: auto; }
  }
  
  .mat-card-header {
    @apply mb-6 pb-4 border-b border-gray-100 dark:border-gray-700;
  }
  
  .mat-card-title {
    @apply text-2xl font-bold text-gray-900 dark:text-white;
  }

  .form-row {
    @apply flex flex-wrap gap-5 mb-6;

    .form-field {
      @apply flex-1 min-w-[250px];
      
      // Explicit invalid state when we set [class.invalid]
      &.invalid {
        // Outline for MDC-based mat-form-field (outlined appearance)
        .mdc-notched-outline__leading,
        .mdc-notched-outline__notch,
        .mdc-notched-outline__trailing {
          border-color: #dc2626 !important; // red-600
          border-width: 2px !important;
        }
        // Floating label color
        .mat-mdc-floating-label {
          color: #dc2626 !important;
        }
        // Input and icon colors (prefix/suffix)
        .mat-mdc-form-field-icon-prefix,
        .mat-mdc-form-field-icon-suffix {
          color: #dc2626 !important;
        }
        // Error message color
        .mat-mdc-form-field-error {
          color: #dc2626 !important;
          font-size: 0.75rem;
          margin-top: 0.5rem;
        }
      }
      
      .mat-form-field-wrapper {
        @apply pb-0;
      }
      
      .mat-form-field-outline {
        @apply bg-gray-50 dark:bg-gray-700 rounded-md;
      }
      
      .mat-form-field-outline-thick {
        @apply bg-white dark:bg-gray-600;
      }
      
      .mat-form-field-label {
        @apply text-gray-700 dark:text-gray-300;
      }
      
      .mat-input-element {
        @apply text-gray-900 dark:text-white;
      }
      
      .mat-form-field-underline {
        @apply hidden;
      }
      
      &.mat-form-field-invalid {
        .mat-form-field-outline {
          @apply border-red-500 dark:border-red-400;
        }
      }
    }
  }

  .hobbies-section {
    @apply my-6 p-4 md:p-6 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-700/50;
    transition: all 0.2s ease-in-out;
    position: relative;
    
    &:hover {
      @apply border-gray-300 dark:border-gray-600;
    }

    &.invalid {
      border-color: #dc2626 !important; // red-600
      border-width: 2px;
      background-color: rgba(220, 38, 38, 0.03);
      
      h3 { 
        color: #dc2626 !important; 
      }
      
      .hobbies-error {
        color: #dc2626;
        font-size: 0.75rem;
        margin-top: 0.5rem;
        display: block;
      }
    }
    
    .hobbies-error {
      display: none;
    }

    h3 {
      @apply mt-0 text-gray-900 dark:text-white text-xl font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-600;
    }

    .hobby-inputs {
      @apply flex flex-wrap gap-4 mb-4 items-end;

      .hobby-field {
        @apply flex-[2] min-w-[200px];
      }

      .duration-field {
        @apply flex-1 min-w-[150px];
      }

      button {
        @apply h-14 mb-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg px-6 transition-all duration-200;
        box-shadow: 0 2px 5px rgba(37, 99, 235, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        
        &:hover {
          box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
          transform: translateY(-1px);
        }
        
        &:active {
          transform: translateY(0);
        }
        
        &:disabled {
          @apply bg-gray-300 dark:bg-gray-600 cursor-not-allowed;
          transform: none;
          box-shadow: none;
        }
      }
    }

    .hobbies-list {
      @apply mt-4;

      .hobby-chips {
        @apply flex flex-wrap gap-3;
        margin-bottom: 16px;
      }

      .hobby-chip {
        @apply inline-flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium;
        @apply bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100;
        @apply border border-blue-200 dark:border-blue-800;
        transition: all 0.2s ease;
        margin: 4px;
        min-height: 32px;
        
        &:hover {
          @apply bg-blue-200 dark:bg-blue-800;
          transform: translateY(-1px);
        }
        
        &.invalid-hobby {
          @apply bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-100;
          @apply border border-red-200 dark:border-red-800;
          
          &:hover {
            @apply bg-red-200 dark:bg-red-800;
          }
        }
        
        .hobby-text {
          @apply flex-1;
        }
        
        .remove-button {
          @apply text-blue-500 dark:text-blue-300 cursor-pointer;
          font-size: 18px;
          font-weight: bold;
          padding: 2px 6px;
          border: none;
          background: none;
          border-radius: 50%;
          transition: all 0.2s ease;
          opacity: 0.7;
          min-width: 24px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
          
          &:hover {
            @apply bg-blue-200 dark:bg-blue-700;
            opacity: 1;
            transform: scale(1.1);
          }
        }
        
        &.invalid-hobby .remove-button {
          @apply text-red-500 dark:text-red-300;
          
          &:hover {
            @apply bg-red-200 dark:bg-red-700;
          }
        }
      }
    }
  }

  mat-card-actions {
    @apply p-4 pt-0 m-0 mt-2;

    button[type='submit'] {
      @apply min-w-[140px] h-12 text-base font-medium rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-all;
      box-shadow: 0 2px 5px rgba(37, 99, 235, 0.2);
      
      &:hover {
        box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
        transform: translateY(-1px);
      }
      
      &:active {
        transform: translateY(0);
      }
      
      &:disabled {
        @apply bg-gray-300 dark:bg-gray-600 cursor-not-allowed;
        transform: none;
        box-shadow: none;
      }
    }
  }

  // Dark mode support
  @media (prefers-color-scheme: dark) {
    .mat-form-field-outline {
      @apply bg-gray-800;
    }
    
    .mat-form-field-label {
      @apply text-gray-400;
    }
    
    .mat-input-element {
      @apply text-white;
    }
  }
  
  // Responsive adjustments
  @media (max-width: 768px) {
    .form-row {
      @apply flex-col gap-4;
    }
    
    .hobby-field, .duration-field {
      @apply w-full;
    }
  }
  
  @media (max-width: 640px) {
    .hobby-inputs {
      @apply flex-col gap-4;

      button {
        @apply w-full m-0;
      }
    }
    
    .mat-card {
      @apply p-4;
    }
  }
  
  // Animations
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .mat-form-field {
    animation: fadeIn 0.3s ease-out;
  }
  
  // Анимация для появления ошибок
  .mat-mdc-form-field-error {
    animation: fadeIn 0.3s ease-in-out;
  }
  
  // Стили для индикатора загрузки
  .mat-mdc-form-field-suffix {
    .mat-mdc-progress-spinner {
      margin-left: 8px;
      
      circle {
        stroke: #3f51b5;
      }
    }
  }
  
  // Кастомные стили для ошибок
  .mat-mdc-form-field-error {
    @apply text-red-500 dark:text-red-400 text-sm mt-1;
  }
  
  // Анимация появления ошибок
  @keyframes fadeIn {
    from { 
      opacity: 0;
      transform: translateY(-5px);
    }
    to { 
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  // Стили для кнопки отправки
  .submit-button {
    @apply mt-4;
    
    button {
      @apply bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg transition-all duration-200;
      min-width: 150px;
      height: 48px;
      
      &:disabled {
        @apply bg-gray-400 cursor-not-allowed;
      }
      
      .mat-icon {
        @apply text-white;
      }
    }
  }

  // Стили для списка агрегированных ошибок под кнопкой
  .form-errors {
    @apply mt-3;
    ul { @apply list-disc pl-5 m-0; }
    li {
      @apply text-red-600 dark:text-red-400 text-sm leading-6;
      color: #dc2626 !important; // enforce red for errors
      animation: fadeIn 0.2s ease-in-out;
    }
  }

  // Snackbar color schemes
  .mat-mdc-snack-bar-container.success-snackbar {
    --mdc-snackbar-container-color: #16a34a; // green-600
    --mdc-snackbar-supporting-text-color: #ffffff;
  }
  .mat-mdc-snack-bar-container.error-snackbar {
    --mdc-snackbar-container-color: #dc2626; // red-600
    --mdc-snackbar-supporting-text-color: #ffffff;
  }

  // Confetti effect styles
  .confetti-container {
    position: fixed;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 9999;
  }

  .confetti-piece {
    position: absolute;
    top: -10vh;
    border-radius: 2px;
    opacity: 0.9;
    animation: confetti-fall 1.6s linear forwards, confetti-spin 1.6s ease-in-out infinite;
  }

  @keyframes confetti-fall {
    0% { transform: translateY(-120%) rotate(0deg); }
    100% { transform: translateY(120vh) rotate(720deg); }
  }

  @keyframes confetti-spin {
    0% { filter: brightness(1); }
    50% { filter: brightness(1.2); }
    100% { filter: brightness(1); }
  }
}
